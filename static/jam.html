<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="dev-environment" content="true">
    <title>Jam Session - Jamanager</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/jam.css?v=20251004t">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    
    <style>
        /* Breadcrumb Navigation Styles */
        .breadcrumb-nav {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .breadcrumb-item {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        
        .breadcrumb-item:hover {
            color: #5a67d8;
            text-decoration: underline;
        }
        
        .breadcrumb-item.active {
            color: #4a5568;
            font-weight: 600;
        }
        
        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 8px;
            font-weight: 400;
        }
        
        .breadcrumb-nav a {
            text-decoration: none;
        }
        
        .breadcrumb-nav a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>
    
    <!-- Background Layer -->
    <div id="backgroundLayer" class="background-layer"></div>
    <div class="background-overlay"></div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Breadcrumb Navigation -->
        <div id="breadcrumb-container"></div>
        
        <!-- Header Section -->
        <header class="jam-header card">
            <div class="jam-info">
                <h1 id="jamName">Loading Jam...</h1>
                <p id="jamDescription" class="jam-description"></p>
                <div class="jam-actions">
                    <button id="shareBtn" class="btn btn-secondary" onclick="jamUI.showShareModal()" aria-label="Button" tabindex="0">
                        <span class="btn-icon">🔗</span>
                        Share Jam
                    </button>
        </div>
        </div>
        </header>

        <!-- User Registration Section -->
        <section id="userSection" class="user-section card">
            <!-- Anonymous User State -->
            <div id="anonymousUser" class="user-state">
                <h3>Join the Jam</h3>
                <p>Enter your name to vote on songs and register to perform</p>
                <div class="form-group">
                    <input type="text" id="userName" placeholder="Your name" class="form-control" aria-label="Input" tabindex="0">
                    <button class="btn btn-primary" onclick="jamUI.registerUser()" aria-label="Button" tabindex="0">Join Jam</button>
                </div>
            </div>

            <!-- Registered User State -->
            <div id="registeredUser" class="user-state hidden">
                <h3>Welcome, <span id="userDisplayName"></span>!</h3>
                <p>You can vote on songs and register to perform</p>
                <div class="user-actions">
                    <button id="addSongBtn" class="btn btn-primary btn-sm hidden" onclick="jamUI.showAddSongModal()" aria-label="Button" tabindex="0">
                        <span class="btn-icon">➕</span>
                        Add Song
                    </button>
                </div>
            </div>
        </section>

        <!-- Songs Section -->
        <section class="songs-section card">
            <div class="songs-header">
                <h3>Song Queue</h3>
                <div class="songs-controls">
                    <!-- Sorting Controls -->
                    <div class="sort-controls">
                        <label for="sortCriteria">Sort by:</label>
                        <select id="sortCriteria" class="form-control form-control-sm">
                            <option value="name">Song Name</option>
                            <option value="artist">Artist</option>
                            <option value="votes">Vote Count</option>
                            <option value="performance">Performance Order</option>
                        </select>
                        <button id="sortDirection" class="sort-toggle-btn" type="button" title="Toggle sort direction" aria-label="Button" tabindex="0">
                            <span class="sort-icon">↓</span>
                        </button>
                    </div>
                    
                    <!-- Performance Filter (Muso Only) -->
                    <div id="performanceFilter" class="filter-controls hidden">
                        <label class="checkbox-label">
                            <input type="checkbox" id="showOnlyMyPerformances" aria-label="Input" tabindex="0">
                            <span class="checkmark"></span>
                            Show only my performances
                        </label>
                    </div>
                </div>
            </div>
            <div id="songsList" class="songs-list">
                    <!-- Songs will be loaded here -->
            </div>
        </section>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal hidden">
        <div class="modal-content">
            <h3>Share This Jam</h3>
            <div class="share-content">
                <div class="share-url">
                    <label>Jam URL:</label>
                    <input type="text" id="shareUrl" readonly class="form-control" aria-label="Input" tabindex="0">
                    <button class="btn btn-secondary btn-sm" onclick="jamUI.copyUrl()" aria-label="Button" tabindex="0">Copy URL</button>
                </div>
                <div class="share-qr">
                    <label>QR Code:</label>
                    <div id="qrCodeContainer">
                        <div id="qrLoading">Generating QR code...</div>
                        <img id="qrCode" class="hidden" alt="QR Code">
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="jamUI.closeShareModal()" aria-label="Button" tabindex="0">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Song Modal -->
    <div id="addSongModal" class="modal hidden">
        <div class="modal-content">
            <h3>Add Song to Jam</h3>
            <div class="form-group">
                <label>Select Song:</label>
                <select id="songSelect" class="form-control">
                    <option value="">Choose a song...</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="jamUI.closeAddSongModal()" aria-label="Button" tabindex="0">Cancel</button>
                <button class="btn btn-primary" onclick="jamUI.addSongToJam()" aria-label="Button" tabindex="0">Add Song</button>
            </div>
        </div>
    </div>

    <!-- Performance Registration Modal -->
    <div id="performModal" class="modal hidden">
        <div class="modal-content">
            <h3>Register to Perform</h3>
            <div class="form-group">
                <label>Instrument:</label>
                <input type="text" id="instrumentInput" placeholder="e.g., Guitar, Piano, Vocals" class="form-control" aria-label="Input" tabindex="0">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="jamUI.closePerformModal()" aria-label="Button" tabindex="0">Cancel</button>
                <button class="btn btn-primary" onclick="jamUI.confirmPerformRegistration()" aria-label="Button" tabindex="0">Register to Perform</button>
            </div>
        </div>
    </div>

    <style>
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #a0aec0;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #f7fafc;
            color: #4a5568;
        }
    </style>

    <!-- Chord Sheet Editor Modal -->
    <div id="chordSheetModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="chordSheetModalTitle">Edit Chord Sheet</h3>
            </div>
            <div class="modal-body">
                <!-- Manual URL Input -->
                <div class="form-group">
                    <label for="chordSheetUrlInput">Chord Sheet URL:</label>
                    <input type="url" id="chordSheetUrlInput" class="form-control" placeholder="Enter chord sheet URL" aria-label="Input" tabindex="0">
                    <button type="button" id="validateUrlBtn" class="btn btn-outline btn-sm" aria-label="Button" tabindex="0">Validate URL</button>
                    <div id="urlValidationResult" class="validation-result hidden"></div>
                </div>
                
                <!-- Ultimate Guitar Search -->
                <div class="form-group">
                    <label>Or find chord sheets automatically:</label>
                    <div class="chord-sheet-search">
                        <button type="button" id="searchChordSheetsBtn" class="btn btn-primary" aria-label="Button" tabindex="0">
                            <span id="searchChordSheetsBtnText">Search Ultimate Guitar</span>
                            <span id="searchChordSheetsSpinner" class="spinner hidden">⏳</span>
                        </button>
                        <div id="chordSheetSearchResults" class="chord-sheet-results hidden">
                            <div id="chordSheetSearchMessage" class="search-message"></div>
                            <div id="chordSheetSearchLinks" class="search-links"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="jamUI.closeChordSheetModal()" aria-label="Button" tabindex="0">Cancel</button>
                <button class="btn btn-primary" onclick="jamUI.saveChordSheet()" aria-label="Button" tabindex="0">Save Chord Sheet</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/dev-indicator.js"></script>
    <script src="/static/breadcrumbs.js"></script>
    <script src="/static/js/notification-system.js?v=20251004"></script>
    <script src="/static/js/jam-core.js?v=20251004"></script>
    <script src="/static/js/jam-attendee.js?v=20251004e"></script>
    <script src="/static/js/jam-songs.js?v=20251004aa"></script>
    <script src="/static/js/jam-websocket.js?v=20251004g"></script>
    <script src="/static/js/jam-chord-sheets.js?v=20251004"></script>
    <script src="/static/js/jam-main.js?v=20251004s"></script>
</body>
</html>

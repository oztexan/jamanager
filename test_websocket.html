<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    <button onclick="vote()">Vote for Song</button>
    
    <script>
        const jamId = 'eb23eb73-595c-4e79-a884-225a975bff7b';
        const songId = '3a8a4590-505e-43e2-81db-0a5076a2ef83';
        
        const ws = new WebSocket(`ws://localhost:8000/ws/${jamId}`);
        
        ws.onopen = function() {
            document.getElementById('status').textContent = 'Connected!';
            addMessage('Connected to WebSocket');
        };
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            addMessage(`Received: ${data.event} - ${JSON.stringify(data.data)}`);
        };
        
        ws.onclose = function() {
            document.getElementById('status').textContent = 'Disconnected';
            addMessage('WebSocket closed');
        };
        
        ws.onerror = function(error) {
            document.getElementById('status').textContent = 'Error';
            addMessage(`Error: ${error}`);
        };
        
        function addMessage(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            document.getElementById('messages').appendChild(div);
        }
        
        function vote() {
            fetch(`/api/jams/${jamId}/songs/${songId}/vote`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                addMessage(`Vote result: ${JSON.stringify(data)}`);
            });
        }
    </script>
</body>
</html>
